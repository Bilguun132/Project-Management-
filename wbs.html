<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="favicon.ico">

  <title>Project Management Simulation</title>
  <link rel="icon" type="image/ico" href="favicon.ico" />

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">

  <!-- Latest compiled and minified CSS
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    Optional theme
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    Latest compiled and minified JavaScript -->
  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->
  -->

  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      $.get("http://137.132.165.53:8000/wbsorder", function (data) {
        var table = document.getElementById('wbsTableBody');
        shuffle(data).forEach(element => {
          console.log(element["wbs_name"]);
          var tr = document.createElement('tr');
          tr.innerHTML = '<td>' + element["wbs_name"] + '</td>';
          table.append(tr);
        });
      });
    })  
  </script>
</head>

<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="home.html">Project Management Simulation</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Samuel Lim</a></li>
          <li><a href="index.html">Log Out</a></li>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>

  <section id="main">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action active">
              <span class="glyphicon glyphicon-file" aria-hidden="true"></span>
              Project Background
            </a>
            <a href="#" class="list-group-item list-group-item-action disabled">
              <span class="glyphicon glyphicon-tasks" aria-hidden="true"></span>
              Project Management
            </a>
          </div>
        </div>

        <div class="col-md-9">
          <div class="container">
            <div class="projectBars">
              <a href="home.html" class="btn btn-default" role="button">Basic Description</a>
              <a href="#" class="btn btn-primary" role="button">Work Breakdown Structure</a>
              <a href="#" class="btn btn-default" role="button" disabled>Project Schedule Network</a>
              <a href="#" class="btn btn-default" role="button" disabled>Critical Path</a>
            </div>

            <style>
              .projectBars {
                justify-content: space-evenly;

              }
            </style>

            <h1>
              Work Breakdown Structure
            </h1>

            <div class="text">
              After gathering requirements of the project, these are the essential activities you have to engage in this
              entire project. Now, click and drag the suitable activity the respective segments form a Work Breakdown
              Structure.
            </div>
            <br>

            <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
            <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.css" rel="stylesheet">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.js"></script>

            <table id="wbsTable" class="table">
              <thead>
                <tr>
                  <th>WBS Name</th>
                </tr>
              </thead>
              <tbody id="wbsTableBody">
                <tr>
                  <td style="font-weight:bold">Planning</td>
                </tr>
                <tr>
                  <td style="font-weight:bold">Product Design</td>
                </tr>
                <tr>
                  <td style="font-weight:bold">Product Development</td>
                </tr>
                <tr>
                  <td style="font-weight:bold">Marketing</td>
                </tr>
                <tr>
                  <td style="font-weight:bold">Product Release</td>
                </tr>
              </tbody>
            </table>
            <button class="btn btn-success" style="text-align:center;"
              onclick="basicDecsriptionNextButton()">NEXT</button>
          </div>
        </div>

        <!-- <script type="text/javascript">
        
        </script> -->

        <script>
          $('tbody').sortable();
          function basicDecsriptionNextButton() {
            var myRows = [];
            var headersText = [];
            var $headers = $("th");

            // Loop through grabbing everything
            var $rows = $("tbody tr").each(function (index) {
              $cells = $(this).find("td");

              $cells.each(function (cellIndex) {
                if ($(this).css('font-weight') == 'bold' || $(this).css('font-weight') == 700) return;
                //   myRows[index] = {};
                // Set the header text
                if (headersText[cellIndex] === undefined) {
                  headersText[cellIndex] = $($headers[cellIndex]).text();
                }
                // Update the row object with the header/cell combo
                // myRows[index][headersText[cellIndex]] = $(this).text();
                myRows.push($(this).text());
              });
            });

            let wbsOrder = [];
            for (i = 0; i < myRows.length; i++) {
              wbsOrder.push({
                order: i,
                name: myRows[i]
              })
            }

            console.log(wbsOrder);
            jQuery.ajax({
              url: "http://137.132.165.53:8000/checkWbs",
              type: "POST",
              data: JSON.stringify({ 'wbs': wbsOrder }),
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              success: function (result) {
                console.log(result.Result);
                if (result.Result != 0) {
                  return swal({
                    title: "Error!",
                    text: "WBS Order is Incorrect!",
                    icon: "error",
                    button: "Try again!",
                  });
                }
                return  swal({
                    title: "Success!",
                    text: "WBS Order is Correct!",
                    icon: "success",
                    button: "Next!",
                  }).then(() => { location.href = "wbsanswer.html" });
              }
            });
            // $.post("http://137.132.165.53:8000/checkWbs", { 'wbs': wbsOrder }).done(function (data) {
            //   console.log(data);
            //   // swal("Success!", "WBS Order is correct!").then(() => { location.href = "wbsanswer.html" });
            // });
          }

          function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

              // Pick a remaining element...
              randomIndex = Math.floor(Math.random() * currentIndex);
              currentIndex -= 1;

              // And swap it with the current element.
              temporaryValue = array[currentIndex];
              array[currentIndex] = array[randomIndex];
              array[randomIndex] = temporaryValue;
            }

            return array;
          }

        </script>

        <!-- /.container -->


        <!-- Bootstrap core JavaScript
    ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
        <script src="js/bootstrap.min.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</body>

</html>